$("#opt-val-tree").append("<%= raw escape_javascript(render(:partial => 'entity', locals: {_option: @option, _option_values: @product_option_values })) %>");

renderUI("#opt-val-tree");

currentIds = $("#product_option_value_ids").val().split(",");
newlyCreatedIds = <%= @product_option_values.map(&:id) %>

idsToUse = union_arrays(currentIds, newlyCreatedIds);

$("#product_option_value_ids").val(idsToUse.join(","));

$.magnificPopup.close();

<% if params[:remove].present? %>
  $("<%= params[:remove] %>").remove();
<% end %>